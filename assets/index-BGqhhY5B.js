(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function s(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(e){if(e.ep)return;e.ep=!0;const r=s(e);fetch(e.href,r)}})();const M=[[[1,1],[1,1]],[[1,1,1],[1,1,1],[1,1,1]],[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1],[1,1,1]],[[1,1],[1,1],[1,1]]],O=[[[1,1,1],[0,1,0]],[[0,1,0],[1,1,1]],[[1,0],[1,1],[1,0]],[[0,1],[1,1],[0,1]],[[1,0],[1,0],[1,1]],[[0,1],[0,1],[1,1]],[[1,1],[1,0],[1,0]],[[1,1],[0,1],[0,1]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,0],[1,1],[0,1]],[[0,1],[1,1],[1,0]],[[1,0,0],[1,0,0],[1,1,1]],[[0,0,1],[0,0,1],[1,1,1]],[[1,1,1],[1,0,0],[1,0,0]],[[1,1,1],[0,0,1],[0,0,1]],[[0,1,0],[1,1,1],[0,1,0]]],T=["#FF0000","#FF4500","#FFA500","#FFD700","#00FF00","#0000FF","#00FFFF","#FF00FF","#800080","#008080"];class N{constructor(){this.grid=Array(8).fill().map(()=>Array(8).fill(0)),this.gridColors=Array(8).fill().map(()=>Array(8).fill(null)),this.score=0,this.candidates=[],this.isGameOver=!1,this.combo=0,this.roundCount=0,this.isClearing=!1,this.onStateChange=null}init(t){this.onStateChange=t,this.roundCount=0,this.isClearing=!1,this.generateCandidates(),this.notify()}generateCandidates(){this.candidates=[],this.roundCount++;let t=0,s=0;this.roundCount<=5?(t=Math.random()>.2?3:2,s=3-t):this.roundCount<=10?(t=Math.random()>.5?2:1,s=3-t):(t=1,s=2);const o=[];for(let e=0;e<t;e++)o.push(M[Math.floor(Math.random()*M.length)]);for(let e=0;e<s;e++)o.push(O[Math.floor(Math.random()*O.length)]);for(let e=o.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1));[o[e],o[r]]=[o[r],o[e]]}o.forEach((e,r)=>{this.candidates.push({matrix:e,id:Date.now()+r,used:!1,color:T[Math.floor(Math.random()*T.length)]})}),this.isClearing||this.checkGameOver()&&(this.isGameOver=!0)}rotateCandidate(t){const s=this.candidates[t];if(!s||s.used)return;const o=s.matrix,e=o.length,r=o[0].length,l=Array.from({length:r},()=>Array(e).fill(0));for(let i=0;i<e;i++)for(let c=0;c<r;c++)l[c][e-1-i]=o[i][c];s.matrix=l,this.notify()}canPlace(t,s,o){const e=t.length,r=t[0].length;if(s+e>8||o+r>8)return!1;for(let l=0;l<e;l++)for(let i=0;i<r;i++)if(t[l][i]===1&&this.grid[s+l][o+i]!==0)return!1;return!0}getPotentialClears(t,s,o){const e=[],r=[],l=[];for(let i=0;i<t.length;i++)for(let c=0;c<t[0].length;c++)t[i][c]===1&&l.push({r:s+i,c:o+c});for(let i=0;i<8;i++){let c=!0;for(let d=0;d<8;d++){const f=this.grid[i][d],m=l.some(a=>a.r===i&&a.c===d);if(f!==1&&f!==2&&!m){c=!1;break}}c&&e.push(i)}for(let i=0;i<8;i++){let c=!0;for(let d=0;d<8;d++){const f=this.grid[d][i],m=l.some(a=>a.r===d&&a.c===i);if(f!==1&&f!==2&&!m){c=!1;break}}c&&r.push(i)}return{rows:e,cols:r}}placeShape(t,s,o){const e=this.candidates[t];if(!e||e.used||!this.canPlace(e.matrix,s,o))return!1;const r=e.matrix;for(let i=0;i<r.length;i++)for(let c=0;c<r[0].length;c++)r[i][c]===1&&(this.grid[s+i][o+c]=1,this.gridColors[s+i][o+c]=e.color);e.used=!0,this.score+=this.calculatePlacementScore(r);const l=this.checkLines();return this.candidates.every(i=>i.used)?this.generateCandidates():l||this.checkGameOver()&&(this.isGameOver=!0),this.notify(),!0}calculatePlacementScore(t){let s=0;for(let o=0;o<t.length;o++)for(let e=0;e<t[0].length;e++)t[o][e]===1&&s++;return s}checkLines(){let t=0;const s=[],o=[];for(let e=0;e<8;e++)this.grid[e].every(r=>r===1||r===2)&&s.push(e);for(let e=0;e<8;e++){let r=!0;for(let l=0;l<8;l++)if(this.grid[l][e]!==1&&this.grid[l][e]!==2){r=!1;break}r&&o.push(e)}if(t=s.length+o.length,t>0){this.combo++,this.isClearing=!0,s.forEach(l=>{this.grid[l].fill(2)}),o.forEach(l=>{for(let i=0;i<8;i++)this.grid[i][l]=2}),this.score+=t*10*t*this.combo;let e=0;for(let l=0;l<8;l++)for(let i=0;i<8;i++)this.grid[l][i]===1&&e++;const r=e===0;return this.notify(r),setTimeout(()=>{s.forEach(l=>{this.grid[l].fill(0),this.gridColors[l].fill(null)}),o.forEach(l=>{for(let i=0;i<8;i++)this.grid[i][l]=0,this.gridColors[i][l]=null}),this.isClearing=!1,this.checkGameOver()&&(this.isGameOver=!0),this.notify()},300),!0}else return this.combo=0,!1}checkGameOver(){const t=this.candidates.filter(s=>!s.used);if(t.length===0)return!1;for(const s of t){let o=!1;for(let e=0;e<8;e++){for(let r=0;r<8;r++)if(this.canPlace(s.matrix,e,r)){o=!0;break}if(o)break}if(o)return!1}return!0}notify(t=!1){this.onStateChange&&this.onStateChange({grid:this.grid,gridColors:this.gridColors,candidates:this.candidates,score:this.score,isGameOver:this.isGameOver,combo:this.combo,isAllCleared:t})}}const g=new N,S=document.getElementById("grid"),A=document.getElementById("candidates"),w=document.getElementById("score");let p=null,h=null,v=34;function q(){X(),g.init(x),document.addEventListener("mousemove",K),document.addEventListener("mouseup",Q),document.addEventListener("touchmove",J,{passive:!1}),document.addEventListener("touchend",Z),window.addEventListener("resize",()=>{X(),x(g),g.candidates&&P(g.candidates)})}function X(){v=(S.getBoundingClientRect().width-10*2-4*7)/8}function $(n,t){if(!h)return null;const s=S.getBoundingClientRect(),o=10,r=v+4,l=h.getBoundingClientRect();if(l.left<s.left-v||l.right>s.right+v||l.top<s.top-v||l.bottom>s.bottom+v)return null;const i=s.left+o,c=s.top+o,d=l.left-i,f=l.top-c,m=Math.round(d/r);return{r:Math.round(f/r),c:m}}function H(n){const t=document.createElement("div");t.className="game-over-overlay",t.innerHTML=`
    <div class="game-over-content">
      <h2>Game Over</h2>
      <p class="final-score">Score: 0</p>
      <button onclick="location.reload()">Play Again</button>
    </div>
  `,document.body.appendChild(t);const s=t.querySelector(".final-score"),o=3e3,e=0,r=n,l=performance.now();function i(d){const f=d-l,m=Math.min(f/o,1),a=1-Math.pow(1-m,3),C=Math.floor(e+(r-e)*a);s.textContent=`Score: ${C}`,m<1&&requestAnimationFrame(i)}const c=t.querySelector(".game-over-content");U(c),requestAnimationFrame(i)}function U(n){let t=!1,s=0,o=0,e=0,r=0,l=0,i=0;n.addEventListener("mousedown",c),document.addEventListener("mouseup",d),document.addEventListener("mousemove",f),n.addEventListener("touchstart",c,{passive:!1}),document.addEventListener("touchend",d),document.addEventListener("touchmove",f,{passive:!1});function c(a){const C=a.clientX||a.touches[0].clientX,b=a.clientY||a.touches[0].clientY;if(e=C-l,r=b-i,a.target===n||n.contains(a.target)){if(a.target.tagName==="BUTTON")return;t=!0}}function d(a){e=s,r=o,t=!1}function f(a){if(t){a.preventDefault();const C=a.clientX||a.touches[0].clientX,b=a.clientY||a.touches[0].clientY;s=C-e,o=b-r,l=s,i=o,m(s,o,n)}}function m(a,C,b){b.style.transform=`translate3d(${a}px, ${C}px, 0)`}}const F=document.getElementById("combo-container");let Y=0;function x(n){j(n.grid,n.gridColors),P(n.candidates),z(n.score),n.combo>0&&n.combo>Y&&(n.combo===1?W():V(n.combo)),Y=n.combo,n.isAllCleared&&_(),n.isGameOver&&(document.querySelector(".game-over-overlay")||H(n.score))}let y=0,L=null;function z(n){if(y===n)return;const t=y,s=2e3,o=performance.now();w.classList.add("score-animating"),L&&cancelAnimationFrame(L);function e(r){const l=r-o,i=Math.min(l/s,1),c=1-Math.pow(1-i,3);y=Math.floor(t+(n-t)*c),w.textContent=y,i<1?L=requestAnimationFrame(e):(w.classList.remove("score-animating"),y=n,w.textContent=y,L=null)}L=requestAnimationFrame(e)}function V(n){const t=document.createElement("div");t.className="combo-popup",t.textContent=`Combo x${n}`,F.innerHTML="",F.appendChild(t),setTimeout(()=>{t.remove()},2e3)}function W(){const n=document.createElement("div");n.className="great-popup",n.textContent="GREAT!",F.innerHTML="",F.appendChild(n),setTimeout(()=>{n.remove()},2e3)}function _(){const n=document.createElement("div");n.className="unbelievable-popup",n.textContent="UNBELIEVABLE!",document.body.appendChild(n),setTimeout(()=>{n.remove()},3e3)}let G=[];function j(n,t){S.innerHTML="",G=[],n.forEach((s,o)=>{const e=[];s.forEach((r,l)=>{const i=document.createElement("div");i.classList.add("cell"),i.dataset.r=o,i.dataset.c=l,r===1?(i.classList.add("filled"),t&&t[o][l]&&(i.style.backgroundColor=t[o][l])):r===2&&(i.classList.add("filled"),i.classList.add("clearing"),t&&t[o][l]&&(i.style.backgroundColor=t[o][l])),S.appendChild(i),e.push(i)}),G.push(e)})}function P(n){A.innerHTML="",n.forEach((t,s)=>{if(t.used)return;const o=document.createElement("div");o.classList.add("candidate-wrapper");const e=D(t.matrix,20,t.color);e.classList.add("candidate-shape"),e.style.pointerEvents="none",o.addEventListener("mousedown",r=>k(r,t,s)),o.addEventListener("touchstart",r=>k(r,t,s),{passive:!1}),o.appendChild(e),A.appendChild(o)})}function D(n,t,s){const o=document.createElement("div");o.style.display="grid";const e=`${t}px`;return o.style.gridTemplateRows=`repeat(${n.length}, ${e})`,o.style.gridTemplateColumns=`repeat(${n[0].length}, ${e})`,o.style.gap="2px",n.forEach(r=>{r.forEach(l=>{const i=document.createElement("div");i.style.width=e,i.style.height=e,i.style.borderRadius="2px",l===1?(i.classList.add("filled"),s&&(i.style.backgroundColor=s)):i.style.backgroundColor="transparent",o.appendChild(i)})}),o}let E=null,u=null;function k(n,t,s){n.preventDefault();const o=n.clientX||n.touches[0].clientX,e=n.clientY||n.touches[0].clientY;u={candidate:t,index:s,startX:o,startY:e,target:n.currentTarget}}function R(n){if(!u)return;const{candidate:t,index:s,target:o}=u;p={candidate:t,index:s},E=o,E&&(E.style.opacity="0"),h=D(t.matrix,v,t.color),h.style.gap="4px",Array.from(h.children).forEach(d=>{d.style.borderRadius="4px"}),h.classList.add("dragging"),h.style.position="absolute",h.style.pointerEvents="none",h.style.zIndex="1000",h.style.opacity="0.8",document.body.appendChild(h);const e=h.getBoundingClientRect();e.width/2;const l=n.type.startsWith("touch")?100:0;e.height/2+l;const i=n.clientX||n.touches[0].clientX,c=n.clientY||n.touches[0].clientY;updateDragPosition(i,c),u=null}function K(n){p?updateDragPosition(n.clientX,n.clientY):u&&Math.hypot(n.clientX-u.startX,n.clientY-u.startY)>5&&R(n)}function J(n){if((p||u)&&n.preventDefault(),p)updateDragPosition(n.touches[0].clientX,n.touches[0].clientY);else if(u){const t=n.touches[0];Math.hypot(t.clientX-u.startX,t.clientY-u.startY)>5&&R(n)}}function Q(n){p?(I(n.clientX,n.clientY),B()):u&&(g.rotateCandidate(u.index),u=null)}function Z(n){if(p){const t=n.changedTouches[0];I(t.clientX,t.clientY),B()}else u&&(g.rotateCandidate(u.index),u=null)}function B(){h&&(h.remove(),h=null),E&&(E.style.opacity="1",E=null),p=null,ee()}function ee(){S.querySelectorAll(".highlight, .highlight-clear").forEach(t=>{t.classList.remove("highlight"),t.classList.remove("highlight-clear");const s=parseInt(t.dataset.r),o=parseInt(t.dataset.c);(g.grid[s][o]===1||g.grid[s][o]===2)&&g.gridColors[s][o]?t.style.backgroundColor=g.gridColors[s][o]:t.style.backgroundColor=""})}function I(n,t){const s=$();if(s){const{r:o,c:e}=s;g.placeShape(p.index,o,e)}}q();
