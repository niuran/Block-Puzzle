(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(e){if(e.ep)return;e.ep=!0;const r=s(e);fetch(e.href,r)}})();const w=[[[1,1],[1,1]],[[1,1,1],[1,1,1],[1,1,1]],[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1],[1,1,1]],[[1,1],[1,1],[1,1]]],T=[[[1,1,1],[0,1,0]],[[0,1,0],[1,1,1]],[[1,0],[1,1],[1,0]],[[0,1],[1,1],[0,1]],[[1,0],[1,0],[1,1]],[[0,1],[0,1],[1,1]],[[1,1],[1,0],[1,0]],[[1,1],[0,1],[0,1]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,0],[1,1],[0,1]],[[0,1],[1,1],[1,0]],[[1,0,0],[1,0,0],[1,1,1]],[[0,0,1],[0,0,1],[1,1,1]],[[1,1,1],[1,0,0],[1,0,0]],[[1,1,1],[0,0,1],[0,0,1]],[[0,1,0],[1,1,1],[0,1,0]]],A=["#FF0000","#FF4500","#FFA500","#FFD700","#00FF00","#0000FF","#00FFFF","#FF00FF","#800080","#008080"];class H{constructor(){this.grid=Array(8).fill().map(()=>Array(8).fill(0)),this.gridColors=Array(8).fill().map(()=>Array(8).fill(null)),this.score=0,this.candidates=[],this.isGameOver=!1,this.combo=0,this.roundCount=0,this.isClearing=!1,this.onStateChange=null}init(t){this.onStateChange=t,this.roundCount=0,this.isClearing=!1,this.generateCandidates(),this.notify()}generateCandidates(){this.candidates=[],this.roundCount++;let t=0,s=0;this.roundCount<=5?(t=Math.random()>.2?3:2,s=3-t):this.roundCount<=10?(t=Math.random()>.5?2:1,s=3-t):(t=1,s=2);const n=[];for(let e=0;e<t;e++)n.push(w[Math.floor(Math.random()*w.length)]);for(let e=0;e<s;e++)n.push(T[Math.floor(Math.random()*T.length)]);for(let e=n.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1));[n[e],n[r]]=[n[r],n[e]]}n.forEach((e,r)=>{this.candidates.push({matrix:e,id:Date.now()+r,used:!1,color:A[Math.floor(Math.random()*A.length)]})}),this.isClearing||this.checkGameOver()&&(this.isGameOver=!0)}canPlace(t,s,n){const e=t.length,r=t[0].length;if(s+e>8||n+r>8)return!1;for(let l=0;l<e;l++)for(let o=0;o<r;o++)if(t[l][o]===1&&this.grid[s+l][n+o]!==0)return!1;return!0}getPotentialClears(t,s,n){const e=[],r=[],l=[];for(let o=0;o<t.length;o++)for(let c=0;c<t[0].length;c++)t[o][c]===1&&l.push({r:s+o,c:n+c});for(let o=0;o<8;o++){let c=!0;for(let a=0;a<8;a++){const f=this.grid[o][a],g=l.some(d=>d.r===o&&d.c===a);if(f!==1&&f!==2&&!g){c=!1;break}}c&&e.push(o)}for(let o=0;o<8;o++){let c=!0;for(let a=0;a<8;a++){const f=this.grid[a][o],g=l.some(d=>d.r===a&&d.c===o);if(f!==1&&f!==2&&!g){c=!1;break}}c&&r.push(o)}return{rows:e,cols:r}}placeShape(t,s,n){const e=this.candidates[t];if(!e||e.used||!this.canPlace(e.matrix,s,n))return!1;const r=e.matrix;for(let o=0;o<r.length;o++)for(let c=0;c<r[0].length;c++)r[o][c]===1&&(this.grid[s+o][n+c]=1,this.gridColors[s+o][n+c]=e.color);e.used=!0,this.score+=this.calculatePlacementScore(r);const l=this.checkLines();return this.candidates.every(o=>o.used)?this.generateCandidates():l||this.checkGameOver()&&(this.isGameOver=!0),this.notify(),!0}calculatePlacementScore(t){let s=0;for(let n=0;n<t.length;n++)for(let e=0;e<t[0].length;e++)t[n][e]===1&&s++;return s}checkLines(){let t=0;const s=[],n=[];for(let e=0;e<8;e++)this.grid[e].every(r=>r===1||r===2)&&s.push(e);for(let e=0;e<8;e++){let r=!0;for(let l=0;l<8;l++)if(this.grid[l][e]!==1&&this.grid[l][e]!==2){r=!1;break}r&&n.push(e)}if(t=s.length+n.length,t>0){this.combo++,this.isClearing=!0,s.forEach(l=>{this.grid[l].fill(2)}),n.forEach(l=>{for(let o=0;o<8;o++)this.grid[o][l]=2}),this.score+=t*10*t*this.combo;let e=0;for(let l=0;l<8;l++)for(let o=0;o<8;o++)this.grid[l][o]===1&&e++;const r=e===0;return this.notify(r),setTimeout(()=>{s.forEach(l=>{this.grid[l].fill(0),this.gridColors[l].fill(null)}),n.forEach(l=>{for(let o=0;o<8;o++)this.grid[o][l]=0,this.gridColors[o][l]=null}),this.isClearing=!1,this.checkGameOver()&&(this.isGameOver=!0),this.notify()},300),!0}else return this.combo=0,!1}checkGameOver(){const t=this.candidates.filter(s=>!s.used);if(t.length===0)return!1;for(const s of t){let n=!1;for(let e=0;e<8;e++){for(let r=0;r<8;r++)if(this.canPlace(s.matrix,e,r)){n=!0;break}if(n)break}if(n)return!1}return!0}notify(t=!1){this.onStateChange&&this.onStateChange({grid:this.grid,gridColors:this.gridColors,candidates:this.candidates,score:this.score,isGameOver:this.isGameOver,combo:this.combo,isAllCleared:t})}}const h=new H,b=document.getElementById("grid"),M=document.getElementById("candidates"),L=document.getElementById("score");let p=null,u=null,R=0,X=0,C=34;function U(){G(),h.init(k),document.addEventListener("mousemove",Q),document.addEventListener("mouseup",ee),document.addEventListener("touchmove",Z,{passive:!1}),document.addEventListener("touchend",te),window.addEventListener("resize",()=>{G(),k(h),h.candidates&&B(h.candidates)})}function G(){C=(b.getBoundingClientRect().width-10*2-4*7)/8}function Y(i,t){if(!u)return null;const s=b.getBoundingClientRect(),n=10,r=C+4,l=u.getBoundingClientRect();if(l.left<s.left-C||l.right>s.right+C||l.top<s.top-C||l.bottom>s.bottom+C)return null;const o=s.left+n,c=s.top+n,a=l.left-o,f=l.top-c,g=Math.round(a/r);return{r:Math.round(f/r),c:g}}function z(i){const t=document.createElement("div");t.className="game-over-overlay",t.innerHTML=`
    <div class="game-over-content">
      <h2>Game Over</h2>
      <p class="final-score">Score: 0</p>
      <button onclick="location.reload()">Play Again</button>
    </div>
  `,document.body.appendChild(t);const s=t.querySelector(".final-score"),n=3e3,e=0,r=i,l=performance.now();function o(a){const f=a-l,g=Math.min(f/n,1),d=1-Math.pow(1-g,3),F=Math.floor(e+(r-e)*d);s.textContent=`Score: ${F}`,g<1&&requestAnimationFrame(o)}const c=t.querySelector(".game-over-content");V(c),requestAnimationFrame(o)}function V(i){let t=!1,s=0,n=0,e=0,r=0,l=0,o=0;i.addEventListener("mousedown",c),document.addEventListener("mouseup",a),document.addEventListener("mousemove",f);function c(d){if(e=d.clientX-l,r=d.clientY-o,d.target===i||i.contains(d.target)){if(d.target.tagName==="BUTTON")return;t=!0}}function a(d){e=s,r=n,t=!1}function f(d){t&&(d.preventDefault(),s=d.clientX-e,n=d.clientY-r,l=s,o=n,g(s,n,i))}function g(d,F,q){q.style.transform=`translate3d(${d}px, ${F}px, 0)`}}const S=document.getElementById("combo-container");let x=0;function k(i){J(i.grid,i.gridColors),B(i.candidates),j(i.score),i.combo>0&&i.combo>x&&(i.combo===1?_():W(i.combo)),x=i.combo,i.isAllCleared&&K(),i.isGameOver&&(document.querySelector(".game-over-overlay")||z(i.score))}let y=0,E=null;function j(i){if(y===i)return;const t=y,s=2e3,n=performance.now();L.classList.add("score-animating"),E&&cancelAnimationFrame(E);function e(r){const l=r-n,o=Math.min(l/s,1),c=1-Math.pow(1-o,3);y=Math.floor(t+(i-t)*c),L.textContent=y,o<1?E=requestAnimationFrame(e):(L.classList.remove("score-animating"),y=i,L.textContent=y,E=null)}E=requestAnimationFrame(e)}function W(i){const t=document.createElement("div");t.className="combo-popup",t.textContent=`Combo x${i}`,S.innerHTML="",S.appendChild(t),setTimeout(()=>{t.remove()},2e3)}function _(){const i=document.createElement("div");i.className="great-popup",i.textContent="GREAT!",S.innerHTML="",S.appendChild(i),setTimeout(()=>{i.remove()},2e3)}function K(){const i=document.createElement("div");i.className="unbelievable-popup",i.textContent="UNBELIEVABLE!",document.body.appendChild(i),setTimeout(()=>{i.remove()},3e3)}let m=[];function J(i,t){b.innerHTML="",m=[],i.forEach((s,n)=>{const e=[];s.forEach((r,l)=>{const o=document.createElement("div");o.classList.add("cell"),o.dataset.r=n,o.dataset.c=l,r===1?(o.classList.add("filled"),t&&t[n][l]&&(o.style.backgroundColor=t[n][l])):r===2&&(o.classList.add("filled"),o.classList.add("clearing"),t&&t[n][l]&&(o.style.backgroundColor=t[n][l])),b.appendChild(o),e.push(o)}),m.push(e)})}function B(i){M.innerHTML="",i.forEach((t,s)=>{if(t.used)return;const n=document.createElement("div");n.classList.add("candidate-wrapper");const e=D(t.matrix,20,t.color);e.classList.add("candidate-shape"),e.style.pointerEvents="none",n.addEventListener("mousedown",r=>P(r,t,s)),n.addEventListener("touchstart",r=>P(r,t,s)),n.appendChild(e),M.appendChild(n)})}function D(i,t,s){const n=document.createElement("div");n.style.display="grid";const e=`${t}px`;return n.style.gridTemplateRows=`repeat(${i.length}, ${e})`,n.style.gridTemplateColumns=`repeat(${i[0].length}, ${e})`,n.style.gap="2px",i.forEach(r=>{r.forEach(l=>{const o=document.createElement("div");o.style.width=e,o.style.height=e,o.style.borderRadius="2px",l===1?(o.classList.add("filled"),s&&(o.style.backgroundColor=s)):o.style.backgroundColor="transparent",n.appendChild(o)})}),n}let v=null;function P(i,t,s){i.preventDefault();const n=i.clientX||i.touches[0].clientX,e=i.clientY||i.touches[0].clientY;p={candidate:t,index:s},v=i.currentTarget,v&&(v.style.opacity="0"),u=D(t.matrix,C,t.color),u.style.gap="4px",Array.from(u.children).forEach(l=>{l.style.borderRadius="4px"}),u.classList.add("dragging"),u.style.position="absolute",u.style.pointerEvents="none",u.style.zIndex="1000",u.style.opacity="0.8",document.body.appendChild(u);const r=u.getBoundingClientRect();R=r.width/2,X=r.height/2,O(n,e)}function O(i,t){u&&(u.style.left=`${i-R}px`,u.style.top=`${t-X}px`,ne())}function Q(i){p&&O(i.clientX,i.clientY)}function Z(i){p&&(i.preventDefault(),O(i.touches[0].clientX,i.touches[0].clientY))}function ee(i){p&&(N(i.clientX,i.clientY),$())}function te(i){if(!p)return;const t=i.changedTouches[0];N(t.clientX,t.clientY),$()}function $(){u&&(u.remove(),u=null),v&&(v.style.opacity="1",v=null),p=null,I()}function ne(i,t){I();const s=Y();if(!s)return;const{r:n,c:e}=s,r=p.candidate.matrix;if(h.canPlace(r,n,e)){for(let c=0;c<r.length;c++)for(let a=0;a<r[0].length;a++)r[c][a]===1&&m[n+c]&&m[n+c][e+a]&&m[n+c][e+a].classList.add("highlight");const{rows:l,cols:o}=h.getPotentialClears(r,n,e);l.forEach(c=>{m[c]&&m[c].forEach(a=>{a.classList.add("highlight-clear")})}),o.forEach(c=>{for(let a=0;a<8;a++)m[a]&&m[a][c]&&m[a][c].classList.add("highlight-clear")})}}function I(){b.querySelectorAll(".highlight, .highlight-clear").forEach(t=>{t.classList.remove("highlight"),t.classList.remove("highlight-clear");const s=parseInt(t.dataset.r),n=parseInt(t.dataset.c);(h.grid[s][n]===1||h.grid[s][n]===2)&&h.gridColors[s][n]?t.style.backgroundColor=h.gridColors[s][n]:t.style.backgroundColor=""})}function N(i,t){const s=Y();if(s){const{r:n,c:e}=s;h.placeShape(p.index,n,e)}}U();
