(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(t){if(t.ep)return;t.ep=!0;const r=s(t);fetch(t.href,r)}})();const T=[[[1,1],[1,1]],[[1,1,1],[1,1,1],[1,1,1]],[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1],[1,1,1]],[[1,1],[1,1],[1,1]]],A=[[[1,1,1],[0,1,0]],[[0,1,0],[1,1,1]],[[1,0],[1,1],[1,0]],[[0,1],[1,1],[0,1]],[[1,0],[1,0],[1,1]],[[0,1],[0,1],[1,1]],[[1,1],[1,0],[1,0]],[[1,1],[0,1],[0,1]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,0],[1,1],[0,1]],[[0,1],[1,1],[1,0]],[[1,0,0],[1,0,0],[1,1,1]],[[0,0,1],[0,0,1],[1,1,1]],[[1,1,1],[1,0,0],[1,0,0]],[[1,1,1],[0,0,1],[0,0,1]],[[0,1,0],[1,1,1],[0,1,0]]],X=["#FF0000","#FF4500","#FFA500","#FFD700","#00FF00","#0000FF","#00FFFF","#FF00FF","#800080","#008080"];class z{constructor(){this.grid=Array(8).fill().map(()=>Array(8).fill(0)),this.gridColors=Array(8).fill().map(()=>Array(8).fill(null)),this.score=0,this.candidates=[],this.isGameOver=!1,this.combo=0,this.roundCount=0,this.isClearing=!1,this.onStateChange=null}init(e){this.onStateChange=e,this.roundCount=0,this.isClearing=!1,this.generateCandidates(),this.notify()}generateCandidates(){this.candidates=[],this.roundCount++;let e=0,s=0;this.roundCount<=5?(e=Math.random()>.2?3:2,s=3-e):this.roundCount<=10?(e=Math.random()>.5?2:1,s=3-e):(e=1,s=2);const n=[];for(let t=0;t<e;t++)n.push(T[Math.floor(Math.random()*T.length)]);for(let t=0;t<s;t++)n.push(A[Math.floor(Math.random()*A.length)]);for(let t=n.length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[n[t],n[r]]=[n[r],n[t]]}n.forEach((t,r)=>{this.candidates.push({matrix:t,id:Date.now()+r,used:!1,color:X[Math.floor(Math.random()*X.length)]})}),this.isClearing||this.checkGameOver()&&(this.isGameOver=!0)}rotateCandidate(e){const s=this.candidates[e];if(!s||s.used)return;const n=s.matrix,t=n.length,r=n[0].length,l=Array.from({length:r},()=>Array(t).fill(0));for(let o=0;o<t;o++)for(let c=0;c<r;c++)l[c][t-1-o]=n[o][c];s.matrix=l,this.notify()}canPlace(e,s,n){const t=e.length,r=e[0].length;if(s+t>8||n+r>8)return!1;for(let l=0;l<t;l++)for(let o=0;o<r;o++)if(e[l][o]===1&&this.grid[s+l][n+o]!==0)return!1;return!0}getPotentialClears(e,s,n){const t=[],r=[],l=[];for(let o=0;o<e.length;o++)for(let c=0;c<e[0].length;c++)e[o][c]===1&&l.push({r:s+o,c:n+c});for(let o=0;o<8;o++){let c=!0;for(let a=0;a<8;a++){const g=this.grid[o][a],m=l.some(d=>d.r===o&&d.c===a);if(g!==1&&g!==2&&!m){c=!1;break}}c&&t.push(o)}for(let o=0;o<8;o++){let c=!0;for(let a=0;a<8;a++){const g=this.grid[a][o],m=l.some(d=>d.r===a&&d.c===o);if(g!==1&&g!==2&&!m){c=!1;break}}c&&r.push(o)}return{rows:t,cols:r}}placeShape(e,s,n){const t=this.candidates[e];if(!t||t.used||!this.canPlace(t.matrix,s,n))return!1;const r=t.matrix;for(let o=0;o<r.length;o++)for(let c=0;c<r[0].length;c++)r[o][c]===1&&(this.grid[s+o][n+c]=1,this.gridColors[s+o][n+c]=t.color);t.used=!0,this.score+=this.calculatePlacementScore(r);const l=this.checkLines();return this.candidates.every(o=>o.used)?this.generateCandidates():l||this.checkGameOver()&&(this.isGameOver=!0),this.notify(),!0}calculatePlacementScore(e){let s=0;for(let n=0;n<e.length;n++)for(let t=0;t<e[0].length;t++)e[n][t]===1&&s++;return s}checkLines(){let e=0;const s=[],n=[];for(let t=0;t<8;t++)this.grid[t].every(r=>r===1||r===2)&&s.push(t);for(let t=0;t<8;t++){let r=!0;for(let l=0;l<8;l++)if(this.grid[l][t]!==1&&this.grid[l][t]!==2){r=!1;break}r&&n.push(t)}if(e=s.length+n.length,e>0){this.combo++,this.isClearing=!0,s.forEach(l=>{this.grid[l].fill(2)}),n.forEach(l=>{for(let o=0;o<8;o++)this.grid[o][l]=2}),this.score+=e*10*e*this.combo;let t=0;for(let l=0;l<8;l++)for(let o=0;o<8;o++)this.grid[l][o]===1&&t++;const r=t===0;return this.notify(r),setTimeout(()=>{s.forEach(l=>{this.grid[l].fill(0),this.gridColors[l].fill(null)}),n.forEach(l=>{for(let o=0;o<8;o++)this.grid[o][l]=0,this.gridColors[o][l]=null}),this.isClearing=!1,this.checkGameOver()&&(this.isGameOver=!0),this.notify()},300),!0}else return this.combo=0,!1}checkGameOver(){const e=this.candidates.filter(s=>!s.used);if(e.length===0)return!1;for(const s of e){let n=!1;for(let t=0;t<8;t++){for(let r=0;r<8;r++)if(this.canPlace(s.matrix,t,r)){n=!0;break}if(n)break}if(n)return!1}return!0}notify(e=!1){this.onStateChange&&this.onStateChange({grid:this.grid,gridColors:this.gridColors,candidates:this.candidates,score:this.score,isGameOver:this.isGameOver,combo:this.combo,isAllCleared:e})}}const h=new z,S=document.getElementById("grid"),Y=document.getElementById("candidates"),F=document.getElementById("score");let C=null,u=null,R=0,D=0,v=34;function V(){x(),h.init(k),document.addEventListener("mousemove",tt),document.addEventListener("mouseup",nt),document.addEventListener("touchmove",et,{passive:!1}),document.addEventListener("touchend",it),window.addEventListener("resize",()=>{x(),k(h),h.candidates&&I(h.candidates)})}function x(){v=(S.getBoundingClientRect().width-10*2-4*7)/8}function B(i,e){if(!u)return null;const s=S.getBoundingClientRect(),n=10,r=v+4,l=u.getBoundingClientRect();if(l.left<s.left-v||l.right>s.right+v||l.top<s.top-v||l.bottom>s.bottom+v)return null;const o=s.left+n,c=s.top+n,a=l.left-o,g=l.top-c,m=Math.round(a/r);return{r:Math.round(g/r),c:m}}function W(i){const e=document.createElement("div");e.className="game-over-overlay",e.innerHTML=`
    <div class="game-over-content">
      <h2>Game Over</h2>
      <p class="final-score">Score: 0</p>
      <button onclick="location.reload()">Play Again</button>
    </div>
  `,document.body.appendChild(e);const s=e.querySelector(".final-score"),n=3e3,t=0,r=i,l=performance.now();function o(a){const g=a-l,m=Math.min(g/n,1),d=1-Math.pow(1-m,3),y=Math.floor(t+(r-t)*d);s.textContent=`Score: ${y}`,m<1&&requestAnimationFrame(o)}const c=e.querySelector(".game-over-content");j(c),requestAnimationFrame(o)}function j(i){let e=!1,s=0,n=0,t=0,r=0,l=0,o=0;i.addEventListener("mousedown",c),document.addEventListener("mouseup",a),document.addEventListener("mousemove",g),i.addEventListener("touchstart",c,{passive:!1}),document.addEventListener("touchend",a),document.addEventListener("touchmove",g,{passive:!1});function c(d){const y=d.clientX||d.touches[0].clientX,L=d.clientY||d.touches[0].clientY;if(t=y-l,r=L-o,d.target===i||i.contains(d.target)){if(d.target.tagName==="BUTTON")return;e=!0}}function a(d){t=s,r=n,e=!1}function g(d){if(e){d.preventDefault();const y=d.clientX||d.touches[0].clientX,L=d.clientY||d.touches[0].clientY;s=y-t,n=L-r,l=s,o=n,m(s,n,i)}}function m(d,y,L){L.style.transform=`translate3d(${d}px, ${y}px, 0)`}}const O=document.getElementById("combo-container");let G=0;function k(i){Z(i.grid,i.gridColors),I(i.candidates),_(i.score),i.combo>0&&i.combo>G&&(i.combo===1?J():K(i.combo)),G=i.combo,i.isAllCleared&&Q(),i.isGameOver&&(document.querySelector(".game-over-overlay")||W(i.score))}let E=0,w=null;function _(i){if(E===i)return;const e=E,s=2e3,n=performance.now();F.classList.add("score-animating"),w&&cancelAnimationFrame(w);function t(r){const l=r-n,o=Math.min(l/s,1),c=1-Math.pow(1-o,3);E=Math.floor(e+(i-e)*c),F.textContent=E,o<1?w=requestAnimationFrame(t):(F.classList.remove("score-animating"),E=i,F.textContent=E,w=null)}w=requestAnimationFrame(t)}function K(i){const e=document.createElement("div");e.className="combo-popup",e.textContent=`Combo x${i}`,O.innerHTML="",O.appendChild(e),setTimeout(()=>{e.remove()},2e3)}function J(){const i=document.createElement("div");i.className="great-popup",i.textContent="GREAT!",O.innerHTML="",O.appendChild(i),setTimeout(()=>{i.remove()},2e3)}function Q(){const i=document.createElement("div");i.className="unbelievable-popup",i.textContent="UNBELIEVABLE!",document.body.appendChild(i),setTimeout(()=>{i.remove()},3e3)}let p=[];function Z(i,e){S.innerHTML="",p=[],i.forEach((s,n)=>{const t=[];s.forEach((r,l)=>{const o=document.createElement("div");o.classList.add("cell"),o.dataset.r=n,o.dataset.c=l,r===1?(o.classList.add("filled"),e&&e[n][l]&&(o.style.backgroundColor=e[n][l])):r===2&&(o.classList.add("filled"),o.classList.add("clearing"),e&&e[n][l]&&(o.style.backgroundColor=e[n][l])),S.appendChild(o),t.push(o)}),p.push(t)})}function I(i){Y.innerHTML="",i.forEach((e,s)=>{if(e.used)return;const n=document.createElement("div");n.classList.add("candidate-wrapper");const t=$(e.matrix,20,e.color);t.classList.add("candidate-shape"),t.style.pointerEvents="none",n.addEventListener("mousedown",r=>P(r,e,s)),n.addEventListener("touchstart",r=>P(r,e,s),{passive:!1}),n.appendChild(t),Y.appendChild(n)})}function $(i,e,s){const n=document.createElement("div");n.style.display="grid";const t=`${e}px`;return n.style.gridTemplateRows=`repeat(${i.length}, ${t})`,n.style.gridTemplateColumns=`repeat(${i[0].length}, ${t})`,n.style.gap="2px",i.forEach(r=>{r.forEach(l=>{const o=document.createElement("div");o.style.width=t,o.style.height=t,o.style.borderRadius="2px",l===1?(o.classList.add("filled"),s&&(o.style.backgroundColor=s)):o.style.backgroundColor="transparent",n.appendChild(o)})}),n}let b=null,f=null;function P(i,e,s){i.preventDefault();const n=i.clientX||i.touches[0].clientX,t=i.clientY||i.touches[0].clientY;f={candidate:e,index:s,startX:n,startY:t,target:i.currentTarget}}function N(i){if(!f)return;const{candidate:e,index:s,target:n}=f;C={candidate:e,index:s},b=n,b&&(b.style.opacity="0"),u=$(e.matrix,v,e.color),u.style.gap="4px",Array.from(u.children).forEach(a=>{a.style.borderRadius="4px"}),u.classList.add("dragging"),u.style.position="absolute",u.style.pointerEvents="none",u.style.zIndex="1000",u.style.opacity="0.8",document.body.appendChild(u);const t=u.getBoundingClientRect();R=t.width/2;const l=i.type.startsWith("touch")?100:0;D=t.height/2+l;const o=i.clientX||i.touches[0].clientX,c=i.clientY||i.touches[0].clientY;M(o,c),f=null}function M(i,e){u&&(u.style.left=`${i-R}px`,u.style.top=`${e-D}px`,ot())}function tt(i){C?M(i.clientX,i.clientY):f&&Math.hypot(i.clientX-f.startX,i.clientY-f.startY)>5&&N(i)}function et(i){if((C||f)&&i.preventDefault(),C)M(i.touches[0].clientX,i.touches[0].clientY);else if(f){const e=i.touches[0];Math.hypot(e.clientX-f.startX,e.clientY-f.startY)>5&&N(i)}}function nt(i){C?(U(i.clientX,i.clientY),q()):f&&(h.rotateCandidate(f.index),f=null)}function it(i){if(C){const e=i.changedTouches[0];U(e.clientX,e.clientY),q()}else f&&(h.rotateCandidate(f.index),f=null)}function q(){u&&(u.remove(),u=null),b&&(b.style.opacity="1",b=null),C=null,H()}function ot(i,e){H();const s=B();if(!s)return;const{r:n,c:t}=s,r=C.candidate.matrix;if(h.canPlace(r,n,t)){for(let c=0;c<r.length;c++)for(let a=0;a<r[0].length;a++)r[c][a]===1&&p[n+c]&&p[n+c][t+a]&&p[n+c][t+a].classList.add("highlight");const{rows:l,cols:o}=h.getPotentialClears(r,n,t);l.forEach(c=>{p[c]&&p[c].forEach(a=>{a.classList.add("highlight-clear")})}),o.forEach(c=>{for(let a=0;a<8;a++)p[a]&&p[a][c]&&p[a][c].classList.add("highlight-clear")})}}function H(){S.querySelectorAll(".highlight, .highlight-clear").forEach(e=>{e.classList.remove("highlight"),e.classList.remove("highlight-clear");const s=parseInt(e.dataset.r),n=parseInt(e.dataset.c);(h.grid[s][n]===1||h.grid[s][n]===2)&&h.gridColors[s][n]?e.style.backgroundColor=h.gridColors[s][n]:e.style.backgroundColor=""})}function U(i,e){const s=B();if(s){const{r:n,c:t}=s;h.placeShape(C.index,n,t)}}V();
